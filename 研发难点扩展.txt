LocalCanvas 研发难点扩展

应用开发过程中采用的主要技术
- Android/Kotlin 作为主开发语言与平台。
- Jetpack Compose + Material3 构建 UI 与交互动画。
- Navigation Compose 进行页面路由与底部导航。
- Retrofit + OkHttp + Moshi 对接 AI 生成服务并解析 JSON。
- Kotlin 协程负责异步任务与网络调用。
- Coil Compose 负责图片加载与显示。
- Canvas/Path/Bitmap 实现遮罩绘制与导出 Base64。
- MediaStore 进行生成结果的相册保存与跨版本适配。

技术用处与价值说明
- Android/Kotlin: 统一移动端架构与性能基线，保证与设备能力（相机、相册、存储）深度集成。
- Jetpack Compose + Material3: 快速构建一致的视觉系统与动效反馈，减少传统 XML 布局的维护成本。
- Navigation Compose: 统一多页面流程与回退逻辑，降低状态耦合与导航错误。
- Retrofit + OkHttp + Moshi: 提供稳定的 API 请求、超时控制与 JSON 解析，确保生成服务调用可靠。
- Kotlin 协程: 用结构化并发组织生成任务、遮罩处理与本地存储，避免主线程阻塞与竞态。
- Coil Compose: 高效加载本地/远端图片，减少内存抖动并提升列表与预览体验。
- Canvas/Path/Bitmap: 支撑手势涂抹、遮罩编辑与导出，保障 AI 编辑区域精确可控。
- MediaStore: 适配不同 Android 版本的相册写入与文件管理，降低权限与兼容问题。

研发工作量说明（核心模块与投入）
- UI 与交互体系: 从首页、遮罩编辑、工作流配置、结果页到历史任务，建立统一视觉规范与动效体系。
- 遮罩编辑能力: 实现手势绘制、撤销/清除、笔刷调节、遮罩预览与导出，需大量细节调试。
- AI 生成流程: Prompt 组装、参数配置、请求发起、失败处理、结果回填与二次生成逻辑。
- 任务与历史系统: 任务创建/更新、状态流转、结果持久化与恢复，保证弱网/中断场景可追溯。
- 图片数据链路: Uri/资源读取、Base64 编码、网络传输、结果保存与缓存清理的完整闭环。
- 性能与兼容性: 大图处理、内存控制、不同分辨率适配与 Android 版本差异处理。
- 体验优化: 进度反馈、错误提示、空状态、引导文案与默认参数的多轮打磨。
- 代码文件规模: 目前项目包含 22 个 Kotlin 源码文件与 10 个 XML 资源/配置文件，合计 32 个代码文件（不含图片等二进制资源）。

1) 端侧遮罩编辑与像素级一致性
- Compose Canvas 绘制与真实图像像素网格需要一致的坐标映射。
- 触控采样点密度、笔刷宽度与抗锯齿影响遮罩边缘质量。
- 在不同分辨率与缩放下，遮罩的视觉与导出 PNG 需保持一致。

2) 图像数据链路与内存压力
- 从相册 Uri 读取、Base64 编码、网络上传与本地缓存，链路长且易出错。
- 大图在内存解码、Base64 转换时容易触发 OOM。
- 需要权衡压缩质量与生成效果，避免过度压缩引起细节丢失。

3) 生成服务高延迟与不确定性
- AI 生成耗时不可控，需要长超时与稳定的重试策略。
- 需要清晰的加载态、失败提示与任务可恢复机制。
- 结果返回的 URL 可能延迟可用，需要后置校验与防错处理。

4) 任务队列与本地存储一致性
- 任务创建、更新、失败回写要保证原子性与顺序性。
- JSON 本地存储需考虑并发读写与异常恢复。
- 任务历史要支持重入与结果追溯，避免数据丢失。

5) UI 状态与导航流程复杂度
- 多页面（遮罩、工作流、结果、历史）共享参数与状态，状态管理复杂。
- BackStack 回退与状态清理需要统一策略，避免脏数据残留。
- 动画与交互体验需要在性能与响应速度间平衡。

6) 跨版本存储与权限适配
- Android 10+ 的分区存储对图片保存路径与权限有差异。
- 不同厂商 ROM 对 MediaStore 行为存在差异，需兼容测试。

7) 模型参数与产品体验的平衡
- 采样步数、强度、Prompt 与遮罩范围影响生成质量。
- 需要通过默认值与引导说明降低用户学习成本。
- 本地设备上下文与生成语义融合，容易引入偏差与噪声。
